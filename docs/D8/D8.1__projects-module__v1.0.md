# D8.1 — Projects Module

Status: stable  
Owner: Lead Architect  
Last verified against: (run: `git rev-parse --short HEAD`) — 2025-02-17  
Related documents: D2, D3, D4  

---

## 1. Scope

Documenta el mòdul Projects com a nucli operatiu del sistema.

Inclou:

- Model de dades principal
- Relacions
- Contracte multi-tenant aplicat
- Flux operatiu
- Dependències amb altres mòduls

No documenta detalls de UI visuals.

---

## 2. Core Tables

### projects

Tenant-scoped table.

- org_id uuid NOT NULL
- FK → orgs(id)
- RLS enabled
- Policies basades en is_org_member(org_id)

Conté:

- Identitat del projecte
- Estat / fase
- Metadades operatives
- Enllaços a mòduls relacionats

---

## 3. Related Tables

El mòdul Projects es connecta amb:

- project_phases
- project_marketplaces
- project_tasks
- project_viability
- project_profitability_basic
- project_events
- product_variants
- supplier_quotes
- purchase_orders
- health_runs

Totes segueixen contracte org_id.

---

## 4. Multi-tenant Enforcement

Projects és la font de veritat per:

- Backfill d'altres taules
- Assignació org_id a dependències

Exemple precedent:
health_runs.org_id ← projects.org_id

Cap projecte pot existir sense org_id.

---

## 5. Data Flow

Frontend:

- Carrega projectes filtrats per org_id
- Activa workspace context

Database:

- RLS filtra per org
- Triggers mantenen integritat

---

## 6. Security Model

- SELECT: is_org_member(org_id)
- Mutacions: same policy
- Admin actions: is_org_owner_or_admin

No hi ha cap accés cross-tenant possible via API si RLS està actiu.

---

## 7. Verification

- No projects amb org_id NULL
- No dependències sense parent project
- RLS activat
- Policies existents

---

## 7.1 AS-IS Repo Gaps (Important)

The following tables are referenced by S1.x migrations (org_id backfill / RLS enforcement),
but their CREATE TABLE definitions and FK-to-projects are not present in this repository snapshot:

- project_viability
- project_phases
- project_marketplaces
- project_tasks

Implication:
- org_id is enforced via migrations, but referential integrity to projects(id) cannot be audited from this repo alone.
- Treat these tables as "external-defined or missing-migrations" until their schema migrations are included.

Action:
- Add missing CREATE TABLE migrations (or import the historical bootstrap that defines them) to restore full auditability.

---

## 8. Change Policy

S'ha d'actualitzar aquest document si:

- Es modifica l'estructura de projects
- Es creen noves dependències
- Canvia contracte RLS aplicat al mòdul
