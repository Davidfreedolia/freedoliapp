# D2.2 — Schema Gaps Tracker (Auditability)

Status: stable  
Owner: Lead Architect  
Last verified against: (run: `git rev-parse --short HEAD`) — 2025-02-17  
Related documents: D2, D2.1, D3, D8.x  

---

## Scope

This document tracks missing schema definitions (CREATE TABLE + constraints) that are referenced by migrations
(e.g., S1.2 backfills / RLS enforcement), but are not present in the repository snapshot.

Goal: restore full auditability by ensuring the repo contains all schema-defining migrations.

---

## Critical Missing CREATE TABLE (must be added)

### Orders & Sales domain (D8.4)
- orders — DONE (20260223090000_restore_orders_schema.sql)
- order_items — DONE (20260223091000_restore_order_items_schema.sql)
- sales — DONE (20260223092000_restore_sales_schema.sql)
- inventory_movements — DONE (20260223093000_restore_inventory_movements_schema.sql)

Reason:
- Referenced by S1.2 backfills and RLS, but schema is absent.

---

### Projects domain (D8.1)
- project_viability — DONE (20260223094000_restore_project_viability_schema.sql)
- project_phases — DONE (20260223095000_restore_project_phases_schema.sql)
- project_marketplaces — DONE (20260223100000_restore_project_marketplaces_schema.sql)
- project_tasks — DONE (20260223101000_restore_project_tasks_schema.sql)

Reason:
- Referenced by S1.x enforcement/backfills but schema is absent.

---

### Suppliers domain (D8.2)
- supplier_quote_price_breaks — DONE (20260223102000_restore_supplier_quote_price_breaks_schema.sql)

Reason:
- Referenced by S1.2, schema absent.

---

## Acceptance Criteria (for each missing table)

For each table added to the repo, the following must become auditable from migrations:

1) CREATE TABLE exists in supabase/migrations/
2) Foreign keys are defined (and ON DELETE behavior is explicit)
3) org_id column contract is present (or added via S1.x) and NOT NULL is enforced
4) RLS is enabled and policies are present
5) Verification SQL exists or is added to D10 scripts

---

## Change Policy

Update this tracker whenever:
- a missing schema is added (mark as DONE with migration filename)
- a new missing schema is discovered
